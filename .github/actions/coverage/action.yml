name: Coverage
description: Create, show and upload coverage report
inputs:
    CODECOV_TOKEN:
        type: string
        required: true

runs:
    using: "composite"
    steps:
        #----------------------------------------------
        # download coverage data
        #----------------------------------------------
        - name: Download coverage data
          uses: actions/download-artifact@v4
          with:
              name: coverage-data

        #----------------------------------------------
        #          process coverage report
        #----------------------------------------------
        - name: Show coverage report
          run: |
              source .venv/bin/activate
              coverage combine
              coverage report
              coverage xml
          shell: bash

        #----------------------------------------------
        #          upload coverage report
        #----------------------------------------------

        - name: Upload coverage report to Codecov
          uses: codecov/codecov-action@v4
          with:
              files: ./coverage.xml
              fail_ci_if_error: true
          env:
              CODECOV_TOKEN: ${{ inputs.CODECOV_TOKEN }}
